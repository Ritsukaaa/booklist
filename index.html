<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>ä½œè€…ç¯©é¸æ¸¬è©¦</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .filters, .author-tag-row { margin-bottom: 1em; }
    select { margin-right: 10px; }
    .book-card { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
  </style>
</head>
<body>
  <h2>ä½œè€…åˆ†é¡ç¯©é¸æ¸¬è©¦é </h2>
  <div class="filters">
    <label>è©•åˆ†ï¼š</label>
    <select id="rating-filter">
      <option value="">ğ–¤ è©•åˆ†</option>
      <option value="5">â˜…â˜…â˜…â˜…â˜…</option>
      <option value="4">â˜…â˜…â˜…â˜…â˜†</option>
      <option value="3">â˜…â˜…â˜…â˜†â˜†</option>
      <option value="2">â˜…â˜…â˜†â˜†â˜†</option>
      <option value="1">â˜…â˜†â˜†â˜†â˜†</option>
    </select>
  </div>

  <div class="author-tag-row" id="author-tag-row"></div>

  <div id="bookList"></div>

  <script>
const authorAliasMap = {
  "æ˜è’¿": ["æ˜è’¿", "ç•™è˜…"],
  "ç«¥å­": ["ç«¥å­", "æŠ˜ä¸€æšé‡"],
  "é¢¨å¼„": ["é¢¨å¼„"]
};

const authorTagCategories = ["å…©å€‹å­—", "ä¸‰å€‹å­—", "å››å€‹å­—"];

const bookData = [
  {
    title: "ã€Šå°èªªAã€‹", author: "æ˜è’¿", stars: "â˜…â˜…â˜…â˜…â˜…", plainTags: ["å…©å€‹å­—"], comment: "æ•…äº‹ç²¾å½©"
  },
  {
    title: "ã€Šå°èªªBã€‹", author: "ç•™è˜…", stars: "â˜…â˜…â˜…â˜†â˜†", plainTags: ["å…©å€‹å­—"], comment: "é¢¨æ ¼å†·éœ"
  },
  {
    title: "ã€Šå°èªªCã€‹", author: "ç«¥å­", stars: "â˜…â˜…â˜…â˜…â˜†", plainTags: ["å…©å€‹å­—"], comment: "æ–‡å­—ç´°è†©"
  },
  {
    title: "ã€Šå°èªªDã€‹", author: "æŠ˜ä¸€æšé‡", stars: "â˜…â˜…â˜†â˜†â˜†", plainTags: ["å››å€‹å­—"], comment: "æƒ…ç¯€é¬†æ•£"
  },
  {
    title: "ã€Šå°èªªEã€‹", author: "é¢¨å¼„", stars: "â˜…â˜…â˜…â˜…â˜†", plainTags: ["å…©å€‹å­—"], comment: "ç¶“å…¸è€ä½œ"
  }
];

let currentAuthorFilter = {};
let filteredBooks = [...bookData];

function renderAuthorTagFilters() {
  const row = document.getElementById("author-tag-row");
  authorTagCategories.forEach(category => {
    const select = document.createElement("select");
    select.setAttribute("data-author-tag", category);
    select.innerHTML = `<option value="">ğ–¤ ${category}</option>`;

    const authors = Object.keys(authorAliasMap).filter(author =>
      bookData.find(b => b.author === author && b.plainTags?.includes(category))
    );

    authors.forEach(name => {
      const opt = document.createElement("option");
      opt.value = name;
      opt.textContent = name;
      select.appendChild(opt);
    });

    select.addEventListener("change", () => {
      currentAuthorFilter[category] = select.value;
      applyFilter();
    });

    row.appendChild(select);
  });
}

function applyFilter() {
  const ratingFilter = document.getElementById("rating-filter")?.value || "";

  filteredBooks = bookData.filter(book => {
    const ratingMatch = !ratingFilter || book.stars.startsWith("â˜…".repeat(ratingFilter));
    const authorMatch = Object.entries(currentAuthorFilter).every(([cat, selected]) => {
      if (!selected) return true;
      return (
        book.plainTags?.includes(cat) &&
        authorAliasMap[selected]?.includes(book.author)
      );
    });
    return ratingMatch && authorMatch;
  });

  renderBooks();
}

function renderBooks() {
  const list = document.getElementById("bookList");
  list.innerHTML = "";
  filteredBooks.forEach(book => {
    const div = document.createElement("div");
    div.className = "book-card";
    div.innerHTML = `<strong>${book.title}</strong><br>ä½œè€…ï¼š${book.author}<br>è©•åˆ†ï¼š${book.stars}<br>${book.comment}`;
    list.appendChild(div);
  });
}

document.addEventListener("DOMContentLoaded", () => {
  renderAuthorTagFilters();
  document.getElementById("rating-filter")?.addEventListener("change", applyFilter);
  applyFilter();
});
  </script>
</body>
</html>
